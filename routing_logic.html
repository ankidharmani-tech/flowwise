<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mumbai Route Logic Demo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
body { font-family: "Poppins", sans-serif; background: #f5f7fa; }
#map { height: 420px; border-radius: 8px; margin-top: 10px; }
.container { margin-top: 20px; }
#routeInfo { margin-top: 15px; font-size: 0.95rem; }
</style>
</head>
<body>

<div class="container">
  <h2 class="text-center mb-3">Mumbai Route & Fare Logic</h2>
  <div class="row">
    <div class="col-md-4 col-lg-5  mb-2">
      <label for="startSelect" class="form-label">Select College:</label>
      <select id="startSelect" class="form-select">
        <option value="">-- choose --</option>
        <option value="19.1076,72.8371">Thadomal Shahani College</option>
        <option value="19.1074,72.8370">DJ Sanghvi College</option>
        <option value="19.1031,72.8362">NMIMS</option>
        <option value="19.1233,72.8360">Sardar Patel Institute of Technology</option>
        <option value="19.1334,72.9133">IIT Bombay</option>
        <option value="19.0234,72.8557">VJTI</option>
        <option value="19.1196,72.9055">MPSTME</option>
      </select>
    </div>

    <div class="col-md-4 col-lg-3  mb-2">
      <label for="destSelect" class="form-label">Select Hang-out Spot:</label>
      <select id="destSelect" class="form-select">
        <option value="">-- choose --</option>
        <option value="19.0962,72.8265">Juhu Beach</option>
        <option value="19.0658,72.8264">Carter Road</option>
        <option value="18.9430,72.8238">Marine Drive</option>
        <option value="18.9103,72.8089">Colaba Causeway</option>
        <option value="18.9323,72.8325">Caf√© Mondegar</option>
        <option value="19.0663,72.8334">Phoenix Mall</option>
      </select>
    </div>
    <div class="col-md-4 col-lg-4 mb-2">
      <label for="startSelect" class="form-label">Select College:</label>
      <select id="startSelect" class="form-select">
        <option value="">-- choose --</option>
        <option value="19.1076,72.8371">Thadomal Shahani College</option>
        <option value="19.1074,72.8370">DJ Sanghvi College</option>
        <option value="19.1031,72.8362">NMIMS</option>
        <option value="19.1233,72.8360">Sardar Patel Institute of Technology</option>
        <option value="19.1334,72.9133">IIT Bombay</option>
        <option value="19.0234,72.8557">VJTI</option>
        <option value="19.1196,72.9055">MPSTME</option>
      </select>
    </div>
  </div>
  

  <div class="text-center mt-3">
    <button id="routeBtn" class="btn btn-dark fw-semibold">Show Routes</button>
  </div>

  <div id="map"></div>
  <div id="routeInfo"></div>
</div>

<script>
const map = L.map('map').setView([19.0760, 72.8777], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let fastestLayer, cheapestLayer;

// Fare calculation logic
function calcFare(distanceKm, start, end, night=false) {
  const inBandra = (start.lon>72.81 && start.lon<72.86 && start.lat>19.04 && start.lat<19.10);
  const inVileParle = (start.lon>72.83 && start.lon<72.88 && start.lat>19.09 && start.lat<19.15);
  const inChurchgate = (end.lon<72.84 && end.lat<19.0);

  let fare = 0, mode = "";

  if (inChurchgate) {
    fare = 10 + distanceKm * 2;
    mode = "Train/Metro";
  } else if (inBandra) {
    fare = 15;
    mode = "Shared Rickshaw (Bandra)";
  } else if (inVileParle) {
    fare = 20;
    mode = "Shared Rickshaw (Vile Parle/Andheri)";
  } else if (distanceKm < 1.5) {
    fare = 26;
    mode = "Auto Rickshaw";
  } else {
    fare = 26 + (distanceKm - 1.5) * 17.14;
    mode = "Auto Rickshaw";
  }

  if (night) fare *= 1.25;
  return { fare: fare.toFixed(0), mode };
}

// Get route from OSRM
async function getRoute(lat1, lon1, lat2, lon2, mode="car") {
  const profile = mode === "walk" ? "foot" : "driving";
  const url = `https://router.project-osrm.org/route/v1/${profile}/${lon1},${lat1};${lon2},${lat2}?geometries=geojson&overview=full`;
  const r = await fetch(url);
  const data = await r.json();
  const route = data.routes[0];
  return {
    coords: route.geometry.coordinates.map(c => [c[1], c[0]]),
    distance: route.distance / 1000,
    duration: route.duration / 60
  };
}

document.getElementById('routeBtn').addEventListener('click', async () => {
  const startVal = document.getElementById('startSelect').value;
  const destVal = document.getElementById('destSelect').value;
  const info = document.getElementById('routeInfo');
  if (!startVal || !destVal) {
    info.innerHTML = "‚ö†Ô∏è Please select both locations.";
    return;
  }
  info.innerHTML = "Fetching routes‚Ä¶";

  const [slat, slon] = startVal.split(',').map(Number);
  const [dlat, dlon] = destVal.split(',').map(Number);

  try {
    const fastest = await getRoute(slat, slon, dlat, dlon, 'car');
    const cheapest = await getRoute(slat, slon, dlat, dlon, 'walk');

    if (fastestLayer) map.removeLayer(fastestLayer);
    if (cheapestLayer) map.removeLayer(cheapestLayer);

    fastestLayer = L.polyline(fastest.coords, { color: 'red', weight: 5 }).addTo(map);
    cheapestLayer = L.polyline(cheapest.coords, { color: 'green', weight: 4, dashArray: '8 8' }).addTo(map);

    map.fitBounds(L.latLngBounds(fastest.coords.concat(cheapest.coords)));

    const dist = fastest.distance;
    const night = false;
    const fareData = calcFare(dist, { lat: slat, lon: slon }, { lat: dlat, lon: dlon }, night);

    info.innerHTML = `
      üî¥ <b>Fastest route:</b> ${dist.toFixed(2)} km (~${fastest.duration.toFixed(1)} min)<br>
      üü¢ <b>Cheapest route:</b> ‚Çπ${fareData.fare} (${fareData.mode}), ~${cheapest.duration.toFixed(1)} min
    `;
  } catch (e) {
    console.error(e);
    info.innerHTML = "Error fetching routes. Try again.";
  }
});
</script>

</body>
</html>
